### SILVERSTRIPE START ###

# Deny access to templates (but allow from localhost)
<Files *.ss>
    Order deny,allow
    Deny from all
    Allow from 127.0.0.1
</Files>

# Deny access to IIS configuration
<Files web.config>
    Order deny,allow
    Deny from all
</Files>

# Deny access to YAML configuration files which might include sensitive information
<Files ~ "\.ya?ml$">
    Order allow,deny
    Deny from all
</Files>

# Route errors to static pages automatically generated by SilverStripe
ErrorDocument 404 /assets/error-404.html
ErrorDocument 500 /assets/error-500.html

<IfModule mod_rewrite.c>

    # Turn off index.php handling requests to the homepage fixes issue in apache >=2.4
    <IfModule mod_dir.c>
        DirectoryIndex disabled
        DirectorySlash On
    </IfModule>

    SetEnv HTTP_MOD_REWRITE On
    RewriteEngine On

    # Enable HTTP Basic authentication workaround for PHP running in CGI mode
    RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]

    # Deny access to potentially sensitive files and folders
    RewriteRule ^vendor(/|$) - [F,L,NC]
    RewriteRule ^\.env - [F,L,NC]
    RewriteRule silverstripe-cache(/|$) - [F,L,NC]
    RewriteRule composer\.(json|lock) - [F,L,NC]
    RewriteRule (error|silverstripe|debug)\.log - [F,L,NC]

    # Process through SilverStripe if no file with the requested name exists.
    # Pass through the original path as a query parameter, and retain the existing parameters.
    # Try finding framework in the vendor folder first
    RewriteCond %{REQUEST_URI} ^(.*)$
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteRule .* index.php
</IfModule>
### SILVERSTRIPE END ###
#SSL
#RewriteCond %{HTTPS} off
#RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# Content Security Policy
Header set Content-Security-Policy-Report-Only "default-src 'none'; script-src 'self' code.jquery.com cdnjs.cloudflare.com https://www.googletagmanager.com www.googletagmanager.com https://www.google-analytics.com www.google-analytics.com 'unsafe-inline'; style-src 'self' fonts.googleapis.com cdnjs.cloudflare.com 'unsafe-inline'; img-src 'self' https://www.google-analytics.com www.google-analytics.com https://stats.g.doubleclick.net data:; connect-src 'self' localhost https://www.googletagmanager.com www.googletagmanager.com https://stats.g.doubleclick.net cdnjs.cloudflare.com ws: 'unsafe-inline'; font-src 'self' fonts.googleapis.com; form-action 'self'; report-uri /csp_report.php;"

# Compressione
#FileETag MTime Size
# Pagine
#AddOutputFilterByType DEFLATE text/plain text/html text/xml text/css application/xml application/xhtml+xml application/rss+xml application/javascript application/x-javascript
# Livello - 9 su dual core/7 su hosting condiviso
#DeflateCompressionLevel 9

# Cache
#ExpiresActive On
#ExpiresDefault "now plus 1 hour"
# CSS/JS
#ExpiresByType text/css "now plus 1 week"
#ExpiresByType application/javascript "now plus 1 week"
#ExpiresByType application/x-javascript "now plus 1 week"
# Immagini
#ExpiresByType image/bmp "now plus 1 month"
#ExpiresByType image/jpeg "now plus 1 month"
#ExpiresByType image/gif "now plus 1 month"
#ExpiresByType image/jp2 "now plus 1 month"
#ExpiresByType image/pipeg "now plus 1 month"
#ExpiresByType image/svg+xml "now plus 1 month"
#ExpiresByType image/tiff "now plus 1 month"
#ExpiresByType image/png "now plus 1 month"
#ExpiresByType image/icon "now plus 1 month"
#ExpiresByType image/vnd.microsoft.icon "now plus 1 month"
#ExpiresByType image/x-icon "now plus 1 month"
#ExpiresByType image/ico "now plus 1 month"
#ExpiresByType text/ico "now plus 1 month"
#ExpiresByType image/vnd.wap.wbmp "now plus 1 month"
#ExpiresByType application/vnd.wap.wbxml "now plus 1 month"
#ExpiresByType application/ico "now plus 1 month"